---
name: 法律文件脱敏处理
description: |
  法律文件脱敏/还原工具 - 将法律文档中的敏感信息进行智能替换和脱敏处理，或将脱敏稿还原为原文

  <examples>
  - 帮我把这份合同脱敏处理
  - 我需要脱敏这个法律文件
  - 生成脱敏版本的合同文档
  - 将这份法律文书中的敏感信息替换掉
  - 创建合同的脱敏版本
  - 帮我把脱敏稿还原成原文
  - 使用比对词还原审核稿
  </examples>
---

# 法律文件脱敏处理

将法律文档中的敏感信息进行智能替换和脱敏处理，生成可对外分享的脱敏版本。支持将脱敏稿交由外部审核后，使用比对词还原为原文。

## 核心功能

### 脱敏功能
- **多种脱敏类型**：名称、日期、价格、文件名、项目名、银行账号、案号等
- **智能替换**：根据上下文识别角色（买方/卖方公司）
- **实时预览**：黄色高亮显示脱敏内容
- **格式保留**：完整保留原文格式（段落、表格、字体）
- **白名单/黑名单管理**：精确控制特定内容的脱敏行为；黑名单支持记录项目类型，自动使用对应类型进行脱敏
- **调试模式**：详细日志输出，便于排查问题

### 还原功能
- **自动化还原**：根据比对词自动将【X】标记还原为原文
- **保留审核痕迹**：还原时保留文档中的修订、批注等审核痕迹
- **runs级别替换**：精确替换，不影响其他内容的格式

## 使用方式

### HTML离线工具（推荐）

#### 脱敏模式
1. 打开 `assets/index.html`，选择"脱敏模式"
2. 拖拽或选择docx文件上传
3. 自动识别并预览脱敏效果
4. 手动编辑脱敏项
5. 导出脱敏文件和比对.md文档

#### 还原模式
1. 打开 `assets/index.html`，选择"还原模式"
2. 上传脱敏稿（带审核痕迹的docx）
3. 粘贴比对.md内容
4. 点击"执行还原"，自动下载还原后的文件

### Python脚本

```bash
# 安装依赖
pip install python-docx

# 执行脱敏
python scripts/redact.py input.docx data/rules.json -o output.docx

# 执行还原（保留修订、批注）
python scripts/restore.py redacted.docx mapping.md -o restored.docx
```

## 详细文档

- **工作流程**: [references/workflow.md](references/workflow.md)
- **规则模式库**: [references/patterns.md](references/patterns.md)
- **数据格式**: [references/data-formats.md](references/data-formats.md)
- **脚本使用**: [scripts/README.md](scripts/README.md)
- **HTML使用**: [assets/README.md](assets/README.md)

## 版本历史

- **v1.1.0（2026-02-07）黑名单增强**：
  - 黑名单数据结构升级：从字符串数组升级为对象数组 `{ original, type }`
  - 黑名单类型记录：添加黑名单时一并记录项目类型
  - 智能脱敏：黑名单自动脱敏时使用记录的类型（如【人名1】、【日期1】），而非统一显示【敏感信息】
  - 类型标签显示：黑名单界面显示原文和对应的类型标签
  - 兼容性：自动兼容旧版黑名单数据（字符串格式）

- **v1.0.0（2026-02-06）初始版本**：
  - **脱敏功能**：支持名称、日期、价格、文件名、项目名、银行账号、案号等多种脱敏类型；根据上下文智能识别角色（买方/卖方公司）；黄色高亮实时预览脱敏效果；完整保留原文格式（段落、表格、字体）
  - **白名单/黑名单管理**：精确控制特定内容的脱敏行为；黑名单支持记录项目类型，自动使用对应类型进行脱敏；localStorage持久化存储；跨文件共享设置
  - **调试模式**：详细日志输出；调试面板实时显示；日志导出功能
  - **还原功能**：根据比对.md自动将【X】标记还原为原文；还原时保留文档中的修订、批注等审核痕迹；runs级别精确替换
  - **导出功能**：导出保留原格式的脱敏docx文件；导出替换比对.md（用于还原）；导出调试日志文件
  - **文件上传**：支持拖拽上传脱敏稿docx和比对.md文件；比对.md文件名自动使用docx文件名前缀
  - **规则库**：内置默认脱敏规则，支持自定义规则；支持上下文敏感替换（合同方识别、金额类型识别）
